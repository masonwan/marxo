/*
  backgrid-filter (w/o lunr)
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
  Licensed under the MIT @license.
*/
(function(j,c,e,f){var g=f.Extension.ServerSideFilter=e.View.extend({tagName:"form",className:"backgrid-filter form-search",template:c.template('<div class="input-prepend input-append"><span class="add-on"><i class="icon-search"></i></span><input type="text" <% if (placeholder) { %> placeholder="<%- placeholder %>" <% } %> name="<%- name %>" /><span class="add-on"><a class="close" href="#">&times;</a></span></div>'),events:{"click .close":"clear",submit:"search"},name:"q",placeholder:null,initialize:function(a){f.requireOptions(a,["collection"]);e.View.prototype.initialize.apply(this,arguments);this.name=a.name||this.name;this.placeholder=a.placeholder||this.placeholder;var b=this.collection,d=this;e.PageableCollection&&(b instanceof e.PageableCollection&&"server"==b.mode)&&(b.queryParams[this.name]=function(){return d.$el.find("input[type=text]").val()})},search:function(a){a&&a.preventDefault();a={};a[this.name]=this.$el.find("input[type=text]").val();this.collection.fetch({data:a})},clear:function(a){a&&a.preventDefault();this.$("input[type=text]").val(null);this.collection.fetch()},render:function(){this.$el.empty().append(this.template({name:this.name,placeholder:this.placeholder,value:this.value}));this.delegateEvents();return this}});f.Extension.ClientSideFilter=g.extend({events:{"click .close":function(a){a.preventDefault();this.clear()},"change input[type=text]":"search","keyup input[type=text]":"search",submit:function(a){a.preventDefault();this.search()}},fields:null,wait:149,initialize:function(a){g.prototype.initialize.apply(this,arguments);this.fields=a.fields||this.fields;this.wait=a.wait||this.wait;this._debounceMethods(["search","clear"]);var b=this.collection,d=this.shadowCollection=b.clone();d.url=b.url;d.sync=b.sync;d.parse=b.parse;this.listenTo(b,"add",function(a,b,c){d.add(a,c)});this.listenTo(b,"remove",function(a,b,c){d.remove(a,c)});this.listenTo(b,"sort reset",function(a,b){b=c.extend({reindex:!0},b||{});b.reindex&&d.reset(a.models)})},_debounceMethods:function(a){c.isString(a)&&(a=[a]);this.undelegateEvents();for(var b=0,d=a.length;b<d;b++){var h=a[b];this[h]=c.debounce(this[h],this.wait)}this.delegateEvents()},makeMatcher:function(a){var b=RegExp(a.trim().split(/\W/).join("|"),"i");return function(a){for(var c=this.fields||a.keys(),e=0,f=c.length;e<f;e++)if(b.test(a.get(c[e])+""))return!0;return!1}},search:function(){var a=c.bind(this.makeMatcher(this.$("input[type=text]").val()),this);this.collection.reset(this.shadowCollection.filter(a),{reindex:!1})},clear:function(){this.$("input[type=text]").val(null);this.collection.reset(this.shadowCollection.models,{reindex:!1})}})})(jQuery,_,Backbone,Backgrid);
