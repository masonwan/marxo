!function(){"use strict";var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},n=[].slice;define("console",["lib/common"],function(t){var i,r,o,s,l,a,c,u,p,h,f,_,d,m,y,g,v,w,b,z,k,L,E,C,x,B,S,V,T,P,F,M,q,I,O,D,R,W,H,N,A,U,j,G,J;return E=function(t,e){return null==e&&(e=document),e.querySelector(t)},C=function(t,e){return null==e&&(e=document),[].slice.call(e.querySelectorAll(t))},L=function(t){function n(){return x=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){this.el.view=this,(null!=t?t.parent:void 0)&&(this.parent=t.parent,this.parentEl=this.parent.el)},n}(Backbone.View),o=function(t){function n(){return B=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.el="#main",n.get=function(){return null==this.instance&&(this.instance=new this),this.instance},n.prototype.initialize=function(){var t=this;this.frames={},C(".frame",this.el).forEach(function(e){var n;n=E('#navbar a[href="#'+e.id+'"]'),t.frames[e.id]={id:e.id,el:e,parent:t,navEl:null!=n?n.parentElement:void 0}}),["home","content","profile"].forEach(function(e){return t.frames[e]=new a(t.frames[e])}),this.fixStyles()},n.prototype.fixStyles=function(){var t,e;e=E("#navbar",this.el),t=E("#frames",this.el),(window.onresize=function(){var n;n=e.clientHeight||41,t.style.top=n+"px"})()},n.prototype.showFrame=function(t,e){var n,i,r=this;t=this.frames[t],null!=t&&(t instanceof a?"function"==typeof t.open&&t.open(e):require([t.id],function(n){t=r.frames[t.id]=new n(t),t.render(),"function"==typeof t.open&&t.open(e)}),t.el.classList.contains("active")||(null!=(n=E("#main .frame.active"))&&n.classList.remove("active"),null!=(i=E("#navbar li.active"))&&i.classList.remove("active"),t.el.classList.add("active"),t.navEl.classList.add("active"),$(window).resize()))},n.prototype.signout=function(){delete sessionStorage.user,w.get().show(),this.hide(),this.trigger("signout")},n.prototype.show=function(){this.el.style.visibility="visible",this.el.classList.add("active"),this.el.style.opacity=1},n.prototype.hide=function(){var t=this;this.el.classList.remove("active"),setTimeout(function(){t.el.style.visibility="hidden"},w.prototype.delay)},n}(L),c=function(t){function n(){return R=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){n.__super__.initialize.call(this,t)},n}(L),a=function(t){function n(){return H=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){var e;n.__super__.initialize.call(this,t),this.navEl=t.navEl||(null!=(e=E('#navbar a[href="#'+this.id+'"]'))?e.parentElement:void 0)},n.prototype.switchTo=function(t){var e,n;"string"==typeof t&&(t=this[t]),t&&t instanceof c?(t.el.classList.contains("active")||(console.log("switch inner-frame",null!=(e=t.el)?e.id:void 0),null!=(n=E(".inner-frame.active[name]",this.el))&&n.classList.remove("active"),t.el.classList.add("active")),t.rendered||(t.render(),t.rendered=!0)):console.warn("inner frame cannot find",frameName)},n}(L),r=function(t){function n(){return N=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click .btn-close":"close","click .btn-minimize":"minimize"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t)},n.prototype.render=function(){this.btn_min=E(".btn-minimize",this.el),this.btn_close=E(".btn-close",this.el),this.contentEl=E(".box-content",this.el)},n.prototype.close=function(){console.log("box close button clicked")},n.prototype.minimize=function(){var t,e;t=this.btn_min||E(".btn-minimize",this.el),e=this.contentEl||E(".box-content",this.el),t.classList.contains("icon-up-open")?(e.classList.add("minimized"),t.classList.remove("icon-up-open"),t.classList.add("icon-down-open")):(e.classList.remove("minimized"),t.classList.remove("icon-down-open"),t.classList.add("icon-up-open"))},n}(L),f=function(t){function n(){return A=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){n.__super__.initialize.call(this,t),this.$el.modal({show:!1,backdrop:"static"}),this.$el.on("hidden",this.callback.bind(this))},n.prototype.popup=function(t,e){return this.data=t,this._callback=e,this.show(!0)},n.prototype.callback=function(t){null==t&&(t="cancel"),null!=this._callback&&("function"==typeof this._callback&&this._callback(t,this.data),this.reset())},n.prototype.reset=function(){return this.data=null,this._callback=null,this},n.prototype.cencel=function(){return this.hide(!0)},n.prototype.show=function(t){return this.shown=null!=t?t:!0,this.$el.modal(this.shown?"show":"hide"),this},n.prototype.hide=function(t){return null==t&&(t=!0),this.show(!t)},n}(L),w=function(t){function n(){return U=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.el="#signin",n.get=function(){return null==this.instance&&(this.instance=new this),this.instance},n.prototype.events={"submit form":"submit"},n.prototype.initialize=function(t){n.__super__.initialize.call(this,t),sessionStorage.user?this.signedIn():this.show()},n.prototype.submit=function(){return console.log("sign in"),this.signedIn(),!1},n.prototype.signedIn=function(){var t;t={id:"test",name:"test"},sessionStorage.user=JSON.stringify(t),this.trigger("success",t),this.hide(),o.get().show(),/signin/i.test(location.hash)&&(location.hash="")},n.prototype.delay=500,n.prototype.show=function(){var t=this;this.el.style.opacity=0,this.el.style.display="block",setTimeout(function(){t.el.classList.add("active"),t.el.style.opacity=1},1)},n.prototype.hide=function(){var t=this;this.el.classList.remove("active"),this.el.style.opacity=0,setTimeout(function(){t.el.style.display="none"},this.delay)},n}(L),v=function(t){function n(){return j=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.formatter=null,n.prototype.render=function(){var t=this;return null==this.formatter&&(this.formatter={fromRaw:function(){return t.model._seq+1}}),n.__super__.render.call(this)},n}(Backgrid.StringCell),u=function(t){function n(){return G=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.render=function(){var t;return this.$el.empty(),t=this.formatter.fromRaw(this.model.get(this.column.get("name"))),this.$el.append($("<a>",{tabIndex:-1,href:"#workflow/"+this.model.id,title:t}).text(t)),this.delegateEvents(),this},n}(Backgrid.UriCell),i=function(t){function n(){return J=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.tpl=function(t){var e,n;if(null==t&&(t="action_buttons"),null!=this._tpl&&null!=this._tpl[t])return this._tpl[t];if(e=E("#t_"+t),null==e)throw"cannot find template for type: "+t;return null==this._tpl&&(this._tpl={}),n=this._tpl[t]=e.innerHTML,e.parentNode.removeChild(e),n},n.prototype.render=function(){return this.el.innerHTML=this.constructor.tpl(this.type),this.delegateEvents(),this},n}(Backgrid.Cell),h=function(t){function n(){return S=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.columns=[{name:"",cell:"select-row",headerCell:"select-all"},{name:"",label:"#",cell:v,editable:!1},{name:"title",label:"Title",cell:u,editable:!1},{name:"desc",label:"Description",cell:"string",editable:!1},{name:"status",label:"Status",cell:"string",editable:!1},{name:"created_at",label:"Date Created",cell:"datetime",editable:!1},{name:"updated_at",label:"Date Updated",cell:"datetime",editable:!1},{name:"",label:"Actions",cell:i,editable:!1,sortable:!1}],n.prototype.initialize=function(t){var e;if(n.__super__.initialize.call(this,t),t.collection instanceof p&&(this.collection=t.collection),e=this.collection,!(e instanceof p))throw"collection must be a instance of ManagerCollection";this.grid=new Backgrid.Grid({columns:this.columns,collection:e}),this.paginator=new Backgrid.Extension.Paginator({collection:e}),this.filter=new Backgrid.Extension.ClientSideFilter({collection:e.fullCollection,fields:["title"]})},n.prototype.render=function(){return this.$el.find("table.grid-table").replaceWith(this.grid.render().$el.addClass("grid-table")),this.$el.find(".grid-paginator").replaceWith(this.paginator.render().$el.addClass("grid-paginator")),this.$el.find(".grid-filter").empty().append(this.filter.render().$el),this.collection.fetch({reset:!0}),this},n}(c),s=function(t){function n(){return V=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.set=function(t){return n.__super__.set.call(this,t)},n.prototype.validate=function(t){return t.name&&t.id?/\w{,10}/.test(t.name)?void 0:"name max len is 10 and must be consist of alphabetic char or _":"id and name are required"},n}(Backbone.Model),z=function(t){function n(){return T=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=b,n.prototype.url="/",n}(Backbone.Collection),b=function(t){function n(){return P=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.url=function(){return ROOT+"/"+this.name+"/profile"},n}(s),k=function(t){function n(){return F=n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(s),p=function(t){function i(){return M=i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.mode="client",i.prototype.state={pageSize:20},i.prototype.initialize=function(){var t;t=1<=arguments.length?n.call(arguments,0):[],i.__super__.initialize.apply(this,t),this.on("reset",function(t){t.each(function(t,e){return t._seq=e})})},i.prototype.comparator=function(t){return t.get("id")},i}(Backbone.PageableCollection),d=function(t){function n(){return q=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=_,n.prototype.url="/users",n}(Backbone.Collection),y=function(t){function n(){return I=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=m,n.prototype.url=function(){return this.tenant.url()+"/users"},n}(Backbone.Collection),_=function(t){function n(){return O=n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(k),m=function(t){function n(){return D=n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(k),l=function(t){function n(){return W=n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(k),g=function(t){function n(t){var e=this;n.__super__.constructor.call(this,t),this.route("","home",function(){return e.navigate("home",{replace:!0}),e.show("home")}),this.frames.forEach(function(t){e.route(t+"(/:name)",t,function(n){return e.show(t,n)})}),this.route("signin","signin",function(){}),this.route("signout","signout")}return e(n,t),n.get=function(){return null==this.instance&&(this.instance=new this),this.instance},n.prototype.frames=["home","project","workflow","calendar","content","report","config","profile"],n.prototype.show=function(t,e){var n,i;return sessionStorage.user?(console.log("route",t,e||""),null!=(i=o.get())&&i.showFrame(t,e),n=this[t],null!=n&&n.call(this,e),void 0):(this.navigate("signin",{replace:!0}),void 0)},n.prototype.signout=function(){console.log("sign out"),o.get().signout(),this.navigate("signin",{replace:!0})},n}(Backbone.Router),{async:t,find:E,findAll:C,View:L,ConsoleView:o,BoxView:r,FrameView:a,InnerFrameView:c,ManagerView:h,ModalDialogView:f,SignInView:w,Entity:s,ManagerCollection:p,Tenants:z,Tenant:b,User:k,Participants:d,Publichers:y,Participant:_,Publicher:m,Evalutator:l,Router:g}})}.call(this);
